% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/read_zooplankton_data.R
\name{read_zooplankton_data}
\alias{read_zooplankton_data}
\title{Read NPI zooplanton data from an Excel sheet}
\usage{
read_zooplankton_data(
  data_file,
  sheet = 1,
  dataStart = NULL,
  dataEnd = 1000,
  dataCols = NULL,
  output_format = "as.Date",
  control_species = c("species", "stage", "size_op", "length"),
  lookup_cols = "biomass_conv",
  species_info_cols = NULL,
  remove_missing = TRUE,
  control_stations = FALSE,
  add_coordinates = FALSE,
  control_sample_names = TRUE,
  round2ceiling = FALSE
)
}
\arguments{
\item{data_file}{Path to the Excel file containing zooplankton data}

\item{sheet}{The name or index of the sheet to read the zooplanton data from. See \code{\link[openxlsx]{read.xlsx}}}

\item{dataStart}{The row number where zooplanton data starts from. If \code{NULL} (default), the starting row number is guessed based on the first record of "Calanus finmarchicus".}

\item{dataEnd}{The row number where zooplankton data ends. Larger than real row numbers in data are ignored. The default is 1000. Set to a higher value, if your dataset has more rows than that.}

\item{dataCols}{Optional numeric index indicating the column numbers that contain zooplankton data. Not implemented yet.}

\item{output_format}{Output formar for date. See \code{\link{convert_dates}}.}

\item{control_species}{Either \code{NULL} or a character vector giving the names for species, stage, length operator and length columns from the Excel sheet. These \strong{names will be used as column names in the R output}. The size operator (\code{size_op}) element is used to match old type zooplankton files (most of them) and can be ignored for the new standardized files.}

\item{lookup_cols}{Character vector specifying the names of columns from the zooplankton lookup list (\code{\link{ZOOPL}}) that should be returned together with \code{species_info_cols}. If \code{NULL} (default), only \code{species_info_cols} will be returned. Has no effect, if \code{control_species = FALSE}.}

\item{species_info_cols}{Character vector specifying the names of species information columns that should be preserved. Required only if \code{control_species = NULL}, otherwise ignored. Adds some flexibility if species names are messed up, but use of \code{control_species} list is recommended.}

\item{remove_missing}{Logical indicating whether species with column sums of 0 should be removed from the output.}

\item{control_stations}{Logical indicating whether station names should be controlled against a list of standardized station names (see \code{\link{STATIONS}}). Should be \code{FALSE} for any other dataset than the standard monitoring (MOSJ) datasets.}

\item{add_coordinates}{If \code{TRUE} coordinates will be added to metadata from the list of standardized station names.}

\item{control_sample_names}{Logical indicating whether non-standard symbols in sample names should be replaced by standardized equivalents. May fix problems when trying to merge zooplankton samples with meta data from another file. These names tend to have typos.}

\item{round2ceiling}{Logical indicating whether decimals should be rounded to ceiling integers: some Polish data come rounded this way. It is recommended to ask for nonrounded values as using this parameter may lead to very large biases in biomass estimates of deep samples. This argument is included only for making testing the impact of rounding easier.}
}
\value{
Returns a list of class \code{ZooplanktonData}. The list contains 3 data frames: \code{$data} (abundance data), \code{$meta} (meta-data), and \code{$splist} (species information).
}
\description{
Reads IOPAN and NPI standard format zooplankton data
}
\details{
Zooplankton taxonomy data from IOPAN are received in (more or less) standard format on MS Excel sheets. This function attempts to read that format and enable passing data to futher manipulation in R. The structure of the Excel sheet is explained in Figure 1. 

\figure{zooplankton_data_sheet.png}{options: width=700}

Figure 1. Example how zooplankton Excel sheets tend to be arranged. 
 \enumerate{
    \item \strong{Meta data} are arranged row-vise (with headers on rows) and should contain following fields: "expedition", "station", "sample_name", "date", "from", "to", "unit", and "comment". The field names will be \link[=guess_colname]{guessed}. If the function does not guess the names correctly, try changing the names to the required field names. The \code{dataCols} argument may be used as help to specify the column indices containing data to help the function (currently not implemented). 
    \item \strong{Data} are listed column-wise for each station. Make sure that there are \strong{no blank data columns with meta data} (entirely blank columns are OK) as the function does not manage to separate such columns yet. Specify the row number for beginning (\code{dataStart}) of the data section. Rows > \code{dataStart} will be considered as meta data. The \code{dataEnd} argument can be used in cases where the sheet contains scrap data. Rows > \code{dataEnd} will be dropped. 
    \item \strong{Species list} is arranged column-wise and the field headers should be listed in the \code{control_species} argument.
    \item The correct Excel sheet containing all data is often named "ALL...", but this varies (purple text).
}

The function sums up duplicate species entries for each sample. The function attemps to match the species names in \code{data_file} with the accepted ones listed in \code{\link{ZOOPL}}. Sometimes this routine fails and manual fixes are required. 

The function is currently relatively unstable and most likely requires manual debugging for each dataset.
}
\seealso{
Other ZooplanktonData: 
\code{\link{merge_zooplankton_data}()},
\code{\link{print.ZooplanktonData}()},
\code{\link{subset.ZooplanktonData}()},
\code{\link{summarize_zooplankton_data}()}
}
\author{
Mikko Vihtakari, Anette Wold
}
\concept{ZooplanktonData}
